<div class="govuk-cookie-banner" data-nosnippet role="region" aria-label="Cookies on Request Personal Information">
  <div id="cookies-banner"class="govuk-cookie-banner__message govuk-width-container" role="alert">
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        <h2 class="govuk-cookie-banner__heading govuk-heading-m">
          Cookies on Request for Personal Information
        </h2>
        <div class="govuk-cookie-banner__content">
          <p class="govuk-body">We use some essential cookies to make this service work.</p>
          <p class="govuk-body">We’d also like to use analytics cookies so we can understand how you use the service and make improvements.</p>
        </div>
      </div>
    </div>
    <div id="confirmationBanner" class="govuk-button-group">
      <button id="accept-analytics-cookies" type="button" class="govuk-button" data-module="govuk-button" >
        Accept analytics cookies
      </button>
      <button id="reject-analytics-cookies" type="button" class="govuk-button" data-module="govuk-button">
        Reject analytics cookies
      </button>
      <a class="govuk-link" href="#">View cookies</a>
    </div>
  </div>
  <div id="cookie-confirmation" class="govuk-cookie-banner__message govuk-width-container" role="alert" hidden>
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        <div class="govuk-cookie-banner__content">
          <p id="accepted-cookie-txt" class="govuk-body" hidden>You’ve accepted analytics cookies. You can <a class="govuk-link" href="#">change your cookie settings</a> at any time.</p>
          <p id="rejected-cookie-txt" class="govuk-body" hidden>You’ve rejected analytics cookies. You can <a class="govuk-link" href="#">change your cookie settings</a> at any time.</p>
        </div>
      </div>
    </div>
    <div class="govuk-cookie-banner__message govuk-width-container" role="alert">
      <div class="govuk-button-group">
        <button id="cookie-confirmation-btn" type="button" class="govuk-button" data-module="govuk-button">
          Hide cookie message
        </button>
      </div>
    </div>
  </div>

</div>

<script>
    function handleCookie(action) {
        document.querySelector('#cookies-banner').style.display = 'none';

        fetch(`/cookies/${action}`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
            }
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.text();
            })
            .then(data => {
                console.log(`Cookie ${action}ed successfully:`, data);
                showConfirmationMessage(action);
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    function showConfirmationMessage(action) {
        const confirmationBanner = document.getElementById('cookie-confirmation');
        const acceptMessage = document.getElementById('accepted-cookie-txt');
        const rejectMessage = document.getElementById('rejected-cookie-txt');
        confirmationBanner.removeAttribute('hidden');
        console.log('Showing confirmation message:', action);
        if (action === 'accept') {
            acceptMessage.removeAttribute('hidden');
        } else {
            rejectMessage.removeAttribute('hidden');
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        console.log('DOM fully loaded and parsed');

        document.querySelector('#accept-analytics-cookies').addEventListener('click', () => {
            console.log('Accept button clicked');
            handleCookie('accept');
        });

        document.querySelector('#reject-analytics-cookies').addEventListener('click', () => {
            console.log('Reject button clicked');
            handleCookie('reject');
        });

        document.querySelectorAll('#cookie-confirmation-btn').forEach(button => {
            button.addEventListener('click', () => {
                console.log('Hide cookie message button clicked');
                document.querySelector('.govuk-cookie-banner').style.display = 'none';
            });
        });
    });
</script>
